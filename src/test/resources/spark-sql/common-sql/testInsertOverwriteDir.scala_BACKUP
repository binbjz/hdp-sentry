val test_sql="USE testdb";
spark.sql(test_sql).collect().foreach(println);

/* testInsertOverwriteDir */

val test_sql="SET hive.exec.dynamic.partition=true";
spark.sql(test_sql).collect().foreach(println);
val test_sql="SET hive.vectorized.execution.enabled = true";
spark.sql(test_sql).collect().foreach(println);
val test_sql="SET hive.vectorized.execution.reduce.enabled = true";
spark.sql(test_sql).collect().foreach(println);

scala> sqlContext.sql("select * from predict ").write.format("json").save("predictj")
scala> sqlContext.sql("select * from predict ").write.format("parquet").save("predictp")
scala> sqlContext.sql("select * from predict ").write.format("orc").save("predicto")

txtå’Œcsv


var test_sql="SELECT * FROM testdb.test_insert_overwrite_dir se WHERE se.country = 'US' and se.state = 'CA'";
spark.sql(test_sql).write.format("json").save("spark_ca_employees");


DataFrame peopleDF = spark.read().format("json").load("/tmp/spark_ca_employees/*");





val diamonds = spark.read.format("csv").option("header", "true").option("inferSchema", "true").load("/tmp/spark_ca_employees/*")
display(diamonds)

val diamonds = spark.read.format("csv").option("header", "true").option("inferSchema", "true").load("/tmp/spark_ca_employees/part-00000-b338a2a5-d769-4304-96ef-a5643f90a3c0.json")
display(diamonds)


dfs -cat /tmp/spark_ca_employees/part-00000-b338a2a5-d769-4304-96ef-a5643f90a3c0.json

var test_sql="""INSERT OVERWRITE LOCAL DIRECTORY '/tmp/ca_employees'
SELECT * FROM testdb.test_insert_overwrite_dir se WHERE se.country = 'US' and se.state = 'CA'""";
spark.sql(test_sql).collect().foreach(println);
/*!ls -l /tmp/ca_employees;
!rm -r /tmp/ca_employees;*/

FROM (
SELECT emp.name, emp.salary FROM testdb.test_insert_overwrite_dir emp WHERE emp.salary < 6000
UNION ALL
SELECT emp.name, emp.salary FROM testdb.test_insert_overwrite_dir emp WHERE emp.salary > 7000
) unioninput
INSERT OVERWRITE DIRECTORY '/tmp/union.out' SELECT unioninput.*;

spark.sql(test_sql).collect().foreach(println);
/*dfs -cat /tmp/union.out/*;
dfs -rm -r /tmp/union.out;*/

System.exit(0);
